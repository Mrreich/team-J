// Crear el cuadro (ventana)
const cuadro = document.createElement("div");
cuadro.style.position = "absolute";
cuadro.style.top = "50px";
cuadro.style.left = "50px";
cuadro.style.width = "400px";
cuadro.style.height = "300px";
cuadro.style.background = "black";
cuadro.style.color = "white";
cuadro.style.padding = "20px";
cuadro.style.borderRadius = "12px";
cuadro.style.fontSize = "30px";
cuadro.style.fontFamily = "Arial";
cuadro.style.boxShadow = "0 10px 25px rgba(0,0,0,0.4)";
cuadro.style.transition = "transform 0.4s ease, opacity 0.4s ease, width 0.6s ease, height 0.6s ease";
cuadro.textContent = "team J";
document.body.appendChild(cuadro);

// TamaÃ±o estÃ¡ndar para todos los botones
const btnWidth = "28px";
const btnHeight = "28px";

// Crear botÃ³n "+" para mover (Ãºnico que arrastra)
const moverBtn = document.createElement("button");
moverBtn.textContent = "+";
moverBtn.style.position = "absolute";
moverBtn.style.top = "10px";
moverBtn.style.right = "86px";
moverBtn.style.width = btnWidth;
moverBtn.style.height = btnHeight;
moverBtn.style.background = "gray";
moverBtn.style.color = "white";
moverBtn.style.border = "none";
moverBtn.style.borderRadius = "5px";
moverBtn.style.cursor = "grab";
moverBtn.style.fontSize = "18px";
moverBtn.style.transition = "transform 0.8s ease";
cuadro.appendChild(moverBtn);

// Crear botÃ³n "_" para minimizar
const minimizarBtn = document.createElement("button");
minimizarBtn.textContent = "_";
minimizarBtn.style.position = "absolute";
minimizarBtn.style.top = "10px";
minimizarBtn.style.right = "48px";
minimizarBtn.style.width = btnWidth;
minimizarBtn.style.height = btnHeight;
minimizarBtn.style.background = "gray";
minimizarBtn.style.color = "white";
minimizarBtn.style.border = "none";
minimizarBtn.style.borderRadius = "5px";
minimizarBtn.style.cursor = "pointer";
minimizarBtn.style.fontSize = "18px";
minimizarBtn.style.transition = "transform 0.8s ease";
cuadro.appendChild(minimizarBtn);

// Crear botÃ³n "X" para cerrar
const cerrarBtn = document.createElement("button");
cerrarBtn.textContent = "X";
cerrarBtn.style.position = "absolute";
cerrarBtn.style.top = "10px";
cerrarBtn.style.right = "10px";
cerrarBtn.style.width = btnWidth;
cerrarBtn.style.height = btnHeight;
cerrarBtn.style.background = "gray";
cerrarBtn.style.color = "white";
cerrarBtn.style.border = "none";
cerrarBtn.style.borderRadius = "5px";
cerrarBtn.style.cursor = "pointer";
cerrarBtn.style.fontSize = "18px";
cerrarBtn.style.transition = "transform 0.8s ease";
cuadro.appendChild(cerrarBtn);

// Crear contenedor para "answer esp" + botÃ³n execute
const answerContainer = document.createElement("div");
answerContainer.style.position = "absolute";
answerContainer.style.bottom = "15px";
answerContainer.style.left = "20px";
answerContainer.style.display = "flex";
answerContainer.style.alignItems = "center";
answerContainer.style.gap = "10px";
answerContainer.style.fontSize = "20px";
answerContainer.style.color = "white";
answerContainer.style.transform = "translate(0,0)";
answerContainer.style.transition = "transform 0.8s ease";
cuadro.appendChild(answerContainer);

// Texto "answer esp:"
const answerLabel = document.createElement("span");
answerLabel.textContent = "answer esp:";
answerContainer.appendChild(answerLabel);

// BotÃ³n execute
const executeBtn = document.createElement("button");
executeBtn.textContent = "execute";
executeBtn.style.width = "80px";
executeBtn.style.height = "30px";
executeBtn.style.background = "gray";
executeBtn.style.color = "white";
executeBtn.style.border = "none";
executeBtn.style.borderRadius = "5px";
executeBtn.style.cursor = "pointer";
executeBtn.style.fontSize = "16px";
executeBtn.style.transition = "transform 0.15s ease";
answerContainer.appendChild(executeBtn);

// AnimaciÃ³n de presionar para execute
executeBtn.addEventListener("mousedown", () => {
    executeBtn.style.transform = "scale(0.85)";
});
executeBtn.addEventListener("mouseup", () => {
    executeBtn.style.transform = "scale(1)";
});

// â­ EJECUTAR COLORES AL PRESIONAR EXECUTE â­
let ejecutando = false;
executeBtn.addEventListener("click", () => {
    const cheat = (async () => {
    if (ejecutando) return;
    ejecutando = true;

    setInterval(() => {
        const { stateNode } = Object.values(
            (function react(r = document.querySelector("body>div")) {
                return Object.values(r)[1]?.children?.[0]?._owner.stateNode
                    ? r
                    : react(r.querySelector(":scope>div"));
            })()
        )[1].children[0]._owner;

        const Question = stateNode.state.question || stateNode.props.client.question;

        let ind = 0;

        while (ind < Question.answers.length) {
            let found = false;

            for (let j = 0; j < Question.correctAnswers.length; j++) {
                if (Question.answers[ind] == Question.correctAnswers[j]) {
                    found = true;
                    break;
                }
            }

            const answerButtons = document.querySelectorAll("[class*='answerContainer']");

            if (answerButtons[ind]) {
                if (found) {
                    answerButtons[ind].style.backgroundColor = "green";
                } else {
                    answerButtons[ind].style.backgroundColor = "red";
                }
            }

            ind++;
        }
    }, 1);

    })();
});

// â­â­â­ NUEVO BLOQUE COMPLETO: AUTO ANSWER â­â­â­

const autoContainer = document.createElement("div");
autoContainer.style.position = "absolute";
autoContainer.style.bottom = "60px";
autoContainer.style.left = "20px";
autoContainer.style.display = "flex";
autoContainer.style.alignItems = "center";
autoContainer.style.gap = "10px";
autoContainer.style.fontSize = "20px";
autoContainer.style.color = "white";
autoContainer.style.transition = "transform 0.8s ease"; // â­ SUAVIZA EL MOVIMIENTO
cuadro.appendChild(autoContainer);

const autoLabel = document.createElement("span");
autoLabel.textContent = "auto answer:";
autoContainer.appendChild(autoLabel);

const autoExecuteBtn = document.createElement("button");
autoExecuteBtn.textContent = "execute";
autoExecuteBtn.style.width = "80px";
autoExecuteBtn.style.height = "30px";
autoExecuteBtn.style.background = "gray";
autoExecuteBtn.style.color = "white";
autoExecuteBtn.style.border = "none";
autoExecuteBtn.style.borderRadius = "5px";
autoExecuteBtn.style.cursor = "pointer";
autoExecuteBtn.style.fontSize = "16px";
autoExecuteBtn.style.transition = "transform 0.15s ease";
autoContainer.appendChild(autoExecuteBtn);

autoExecuteBtn.addEventListener("mousedown", () => {
    autoExecuteBtn.style.transform = "scale(0.85)";
});
autoExecuteBtn.addEventListener("mouseup", () => {
    autoExecuteBtn.style.transform = "scale(1)";
autoExecuteBtn.addEventListener("mouseup", () => {
    autoExecuteBtn.style.transform = "scale(1)";
});

// AQUÃ FALTA TU BLOQUE COMPLETO DE AUTOANSWER

// Y LUEGO DEBE CERRAR ASÃ:

}); // â† cierre del addEventListener principal

//placeholderðŸ¥€
autoExecuteBtn.addEventListener("click", () => {

    (() => {

        let iframe = document.querySelector("iframe");
        if (!iframe) {
            iframe = document.createElement("iframe");
            iframe.style.display = "none";
            document.body.append(iframe);
        }

        /* By CryptoDude3 */
        if (window.fetch.call.toString() == 'function call() { [native code] }') {
            const call = window.fetch.call;
            window.fetch.call = function () {
                if (!arguments[1].includes("s.blooket.com/rc")) {
                    return call.apply(this, arguments);
                }
            };
        }

        const timeProcessed = 1730769906975;
        let latestProcess = -1;

        const cheat = async () => {
            const { stateNode } = Object.values(
                (function react(r = document.querySelector("body>div")) {
                    return Object.values(r)[1]?.children?.[0]?._owner.stateNode
                        ? r
                        : react(r.querySelector(":scope>div"));
                })()
            )[1].children[0]._owner;

            const Question = stateNode.state.question || stateNode.props.client.question;

            if (stateNode.state.question.qType != "typing") {
                if (stateNode.state.stage != "feedback" && !stateNode.state.feedback) {
                    let ind;
                    for (ind = 0; ind < Question.answers.length; ind++) {
                        let found = false;
                        for (let j = 0; j < Question.correctAnswers.length; j++) {
                            if (Question.answers[ind] == Question.correctAnswers[j]) {
                                found = true;
                                break;
                            }
                        }
                        if (found) break;
                    }
                    document.querySelectorAll("[class*='answerContainer']")[ind]?.click();
                } else {
                    document.querySelector("[class*='feedback'], [id*='feedback']")?.firstChild?.click();
                }
            } else {
                Object.values(document.querySelector("[class*='typingAnswerWrapper']"))[1]
                    .children._owner.stateNode.sendAnswer?.(Question.answers[0]);
            }
        };

        let img = new Image();
        img.src = "https://raw.githubusercontent.com/Blooket-Council/Blooket-Cheats/main/autoupdate/timestamps/global/autoAnswer.png?" + Date.now();
        img.crossOrigin = "Anonymous";

        img.onload = function () {
            const c = document.createElement("canvas");
            const ctx = c.getContext("2d");

            ctx.drawImage(img, 0, 0, this.width, this.height);

            let { data } = ctx.getImageData(0, 0, this.width, this.height),
                decode = "",
                last;

            let i = 0;
            while (i < data.length) {
                let char = String.fromCharCode(
                    data[i % 4 == 3 ? (i++, i++) : i++] +
                    data[i % 4 == 3 ? (i++, i++) : i++] * 256
                );
                decode += char;
                if (char == "/" && last == "*") break;
                last = char;
            }

            let _, time = timeProcessed,
                error = "There was an error checking for script updates. Run cheat anyway?";

            try {
                [_, time, error] = decode.match(/LastUpdated: (.+?); ErrorMessage: "((.|\n)+?)"/);
            } catch (e) {}

            if ((latestProcess = parseInt(time)) <= timeProcessed || iframe.contentWindow.confirm(error)) {
                cheat();
            }
        };

        img.onerror = img.onabort = () => {
            img.onerror = img.onabort = null;
            cheat();
        };
    // â­ AquÃ­ va el bucle infinito
    setInterval(() => {
        cheat();
    }, 1);

    })(); // â­ CIERRE CORRECTO DEL IIFE

}); // â­ CIERRE CORRECTO DEL addEventListener

// â­â­â­ INTEGRACIÃ“N EN CERRAR (botÃ³n X) â­â­â­

cerrarBtn.addEventListener("click", () => {

    const rect = cuadro.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    function moverAlCentro(btn) {
        const b = btn.getBoundingClientRect();
        const offsetX = centerX - (b.left - rect.left) - b.width / 2;
        const offsetY = centerY - (b.top - rect.top) - b.height / 2;

        btn.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(1)`;
    }

    moverAlCentro(moverBtn);
    moverAlCentro(minimizarBtn);
    moverAlCentro(cerrarBtn);
    moverAlCentro(answerContainer);
    moverAlCentro(autoContainer); // â­ AÃ‘ADIDO

    setTimeout(() => {
        moverBtn.style.transform += " scale(0.05)";
        minimizarBtn.style.transform += " scale(0.05)";
        cerrarBtn.style.transform += " scale(0.05)";
        answerContainer.style.transform += " scale(0.05)";
        autoContainer.style.transform += " scale(0.05)"; // â­ AÃ‘ADIDO
    }, 800);

    setTimeout(() => {
        cuadro.style.transform = "scale(0.05)";
        cuadro.style.opacity = "0";
    }, 1100);

    setTimeout(() => {
        cuadro.remove();
    }, 1500);
});

// â­â­â­ INTEGRACIÃ“N EN MINIMIZAR â­â­â­

let minimizado2 = false;

minimizarBtn.addEventListener("click", () => {
    if (!minimizado2) {
        cuadro.style.height = "80px";
        cuadro.style.width = "260px";
        answerContainer.style.display = "none";
        autoContainer.style.display = "none"; // â­ AÃ‘ADIDO
        minimizado2 = true;
    } else {
        cuadro.style.height = "300px";
        cuadro.style.width = "400px";
        answerContainer.style.display = "flex";
        autoContainer.style.display = "flex"; // â­ AÃ‘ADIDO
        minimizado2 = false;
    }
});

// â­â­â­ ARRASTRAR â­â­â­

let arrastrando2 = false;
let offsetX = 0;
let offsetY = 0;

let targetX = cuadro.offsetLeft;
let targetY = cuadro.offsetTop;

moverBtn.addEventListener("mousedown", (e) => {
    arrastrando2 = true;
    offsetX = e.clientX - cuadro.offsetLeft;
    offsetY = e.clientY - cuadro.offsetTop;
    moverBtn.style.cursor = "grabbing";
    moverBtn.style.transform = "scale(0.85)";
});

function animar() {
    const currentX = parseFloat(cuadro.style.left);
    const currentY = parseFloat(cuadro.style.top);

    cuadro.style.left = currentX + (targetX - currentX) * 0.05 + "px";
    cuadro.style.top = currentY + (targetY - currentY) * 0.05 + "px";

    requestAnimationFrame(animar);
}
animar();

document.addEventListener("mousemove", (e) => {
    if (arrastrando2) {
        targetX = e.clientX - offsetX;
        targetY = e.clientY - offsetY;
    }
});

document.addEventListener("mouseup", () => {
    arrastrando = false;
    moverBtn.style.cursor = "grab";
    moverBtn.style.transform = "scale(1)";
});


// â­â­â­ INTEGRACIÃ“N EN CERRAR (botÃ³n X) â­â­â­

cerrarBtn.addEventListener("click", () => {

    const rect = cuadro.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    function moverAlCentro(btn) {
        const b = btn.getBoundingClientRect();
        const offsetX = centerX - (b.left - rect.left) - b.width / 2;
        const offsetY = centerY - (b.top - rect.top) - b.height / 2;

        btn.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(1)`;
    }

    moverAlCentro(moverBtn);
    moverAlCentro(minimizarBtn);
    moverAlCentro(cerrarBtn);
    moverAlCentro(answerContainer);
    moverAlCentro(autoContainer); // â­ AÃ‘ADIDO

    setTimeout(() => {
        moverBtn.style.transform += " scale(0.05)";
        minimizarBtn.style.transform += " scale(0.05)";
        cerrarBtn.style.transform += " scale(0.05)";
        answerContainer.style.transform += " scale(0.05)";
        autoContainer.style.transform += " scale(0.05)"; // â­ AÃ‘ADIDO
    }, 800);

    setTimeout(() => {
        cuadro.style.transform = "scale(0.05)";
        cuadro.style.opacity = "0";
    }, 1100);

    setTimeout(() => {
        cuadro.remove();
    }, 1500);
});
